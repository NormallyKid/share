Footfrinting
\\\\\=========
Enumeration principles
it stand for infor gathering using active (scans) and passive (use of 3rd party prividers) method
>< OSINT is based exclusively on passive infor gathering and doesnt involve active enum of the given target.enum is a lopp in which we repeadly gather infor based on what data we have or have already discovered
-Infor can be gathered from domains, IP addr, accessible services, and many other sources
-> identified target in infra -> examine the individual services and protocols.inmost cases these are services that enable comm betw customer the infra the admin , and the employees
-must undestand customer structurem before what technical aspects  and services are necessary to be able offer a specific service
-ex of wrong approach could be that after finding authentication services like SSH, RDP, WinRM, and -> try to bruteforece
=>our goal is not to get at the systems but to find all the ways to get there
- understanding a comp internal and external infra, mapping it out, and carefully formulating our plan of atk
What can we see?
What reasons can we have for seeing it?
What image does what we see create for us?
What do we gain from it?
How can we use it?
What can we not see?
What reasons can there be that we do not see?
What image results for us from what we do not see?
=> must not be confused that there are always exception to the rules. the priciples, hwer do not change. another advantage of these principles is that we can see from the practical tasks that we do not lack pen testing abilities but technical understanding when we suddently do not know how to proceed because our core  task is not to exploit the machines but to find how they can be exploited
NO.         priciples
1           There is more than meets the eye. Consider all points of view
2           DIstinguish betw what we see and what we do not see
3           There are always ways to gain more infor. understand the target
\\\\\\\\\\\\====================
Enumeration Methodology
- pentesting and there fore enum, is a dynamic process. consequently we have dev a static enum methodology for external and internal pentest that includes free dynamics and allows for a wide range of changes and adaptions to the given environment.
-this methodology is nested in 6 layers and represents, metaphorically speaking, boundaries that we try to pass with the enum process the whole enum process is divided into three diff level
1. Infrastructure-based enumeration  2. Host-based enumeration  3.OS-based enumeration
NOTE: the comp of each type shown represent the main catergories and not a full list of all the compo to search for. add it must be mentioned here that the first and second layer (internet presensce, gateway) doesnt quite apply to the intranet, such as an AD infra, the layers for internal infra will be convered in other module
Layer	Description	Information Categories
1. Internet Presence	Identification of internet presence and externally accessible infrastructure.	Domains, Subdomains, vHosts, ASN, Netblocks, IP Addresses, Cloud Instances, Security Measures
2. Gateway	Identify the possible security measures to protect the company's external and internal infrastructure.	Firewalls, DMZ, IPS/IDS, EDR, Proxies, NAC, Network Segmentation, VPN, Cloudflare
3. Accessible Services	Identify accessible interfaces and services that are hosted externally or internally.	Service Type, Functionality, Configuration, Port, Version, Interface
4. Processes	Identify the internal processes, sources, and destinations associated with the services.	PID, Processed Data, Tasks, Source, Destination
5. Privileges	Identification of the internal permissions and privileges to the accessible services.	Groups, Users, Permissions, Restrictions, Environment
6. OS Setup	Identification of the internal components and systems setup.	OS Type, Patch Level, Network config, OS Environment, Configuration files, sensitive private files
NOTE: the human aspect and the infor that can be obtained by employees using OSINT have been removed from the "Internet Presence" layer for simplicity
- more time analyze the environment more change to found vuls
- let assume that we have been asked to perform an external "bloack box" pentest.once all the necessary contract items have been completely fulfilled our pentest will begin at the specified time
1 Layer No.1 : Internet Presence -> identified all possible target systems and interfaces that can be tested
2. Layer No.2: Gateway -> understand what we are dealing with and what we have to watch out for
3. Layer No.3: Accessible services ->aim to understand the reason and func of the target systems and gain the necessary knowledge to comm with it and exploit it for our purposes effectively
4. Layer No.4: Processes -> understanding these factors and identify the dependencies bet them
5. Layer No.5: privileges -> it is crucial to identify these and understand what is and is not possible with these privileges
6. Layer No6: OS setup -> see how the admin manage the systems and what sensitive internal infor we can glean from them

=> a methodology is not a step-by-step guide but as the definition implies, a summary of systematic procedures. but as the definition implies.

\\\\\\\\\\\\\\=======================
Domain Information
is a core compo of any pentest, it is not just about the subdomains but about the entire presence on the internet. therefore we gather infor and try to understand the company's functionality and which tech and structure are necessary for services to be offered successfully and efficiently
-this type of infor is gathered passively without direct and active scans. in other words, we remain hidden and navigate as customer or visitor to avoid direct conn to company that could exposed us.
\\Online Presence
after have basic understading of the company and its services, we can get a first impression of its presence on the internet.
EX: assume that a company hired us to test their entire infra from a black-box perspective. this means we have only received a scope of targets and must obtain all further infor ourselves
NOTE: example below will differ from the practical exercised and will not give the same results how, the example are based on real pentests and illustrate how and what infor can be obtained
\\SSL certificate -> check for it validate
\\crt.sh to dinf more subdomain -> this source is certificate transparency logs. is a process that is intended to enable the verification of ussed digital cert for encrypted internet conn.
=> (RFC 6962) provides for the logging of all digital cert . this intended to enable the detection of false or malicious issues cert for a domain/
- ssl cert provider like Let's encrypt share this with the web interface crt.sh, which stores the new entries in the db to be accessed later..
-we can output the result in JSON format
$curl -s https://crt.sh/\?q\=inlanefreight.com\&output\=json | jq .
if needed, we can also have them filtered by the unique subdomains
$curl -s https://crt.sh/\?q\=inlanefreight.com\&output\=json | jq . | grep name | cut -d":" -f2 | grep -v "CN=" | cut -d'"' -f2 | awk '{gsub(/\\n/,"\n");}1;' | sort -u
-next we can identify the hosts directly accessible from the internet and not hosted by third-party providers. this because we are not allowed to test the hosts without the permission of third party providers
$for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f1,4;done
-> once we see which hosts can be invest further, we can generate a list of IP addr with a minor adjustment to the cut command and run them through Shodan
-Shodan can be used to find devices and systems permanently connected to the Internet like IoT. 
it search the internet for open TCP/TCP ports and filters the systems according to specific terms and criteria. EX open http or https ports other server ports
for FTP, SSH, SNMP, Telnet, RTSP, or SIP are searched. as result, we can find device and systems, such as surveillance cameras, servers, smart home system , industrial controller, traffic light and traffic controller, and various network components
\\====================
Shodan - IP list
 $ for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f4 >> ip-addresses.txt;done
 $ for i in $(cat ip-addresses.txt);do shodan host $i;done

 noted for the ip 10.129.127.22 (matomo.inlanefreight.com) -> display all the available DNS records where we might find more hosts
 \\===================
 DNS records 
 $dig any inlanefreight.com
 +A record: IP that point to a specific (sub) domain through the A record.
 +MX record: the mail server records which mail server is responsible for managing the email for the company.(since it handled by google)
 +NS records: these kinds of records show which name server are used tto resolve the FQDN to IP addr, most hosting providers use their own name servers, making it easier to identify the hosting provider
 +TXT records: often contains verification keys for different third-party providers and other security aspects of DNS, such as SPF,DMARC, and DKIM, which are responsible for verifying and confirming the origin of the email sent,
 Here we can already see some valueable infor if we look closer at the result
 ...SNIP... TXT     "MS=ms92346782372"
...SNIP... TXT     "atlassian-domain-verification=IJdXMt1rKCy68JFszSdCKVpwPN"
...SNIP... TXT     "google-site-verification=O7zV5-xFh_jn7JQ31"
...SNIP... TXT     "google-site-verification=bow47-er9LdgoUeah"
...SNIP... TXT     "google-site-verification=gZsCG-BINLopf4hr2"
...SNIP... TXT     "logmein-verification-code=87123gff5a479e-61d4325gddkbvc1-b2bnfghfsed1-3c789427sdjirew63fc"
...SNIP... TXT     "v=spf1 include:mailgun.org include:_spf.google.com include:spf.protection.outlook.com include:_spf.atlassian.net ip4:10.129.24.8 ip4:10.129.27.2 ip4:10.72.82.106 ~all"
Atlassian	Google Gmail	LogMeIn
Mailgun	Outlook	INWX ID/Username
10.129.24.8	10.129.27.2	10.72.82.106
For example, Atlassian states that the company uses this solution for software development and collaboration. If we are not familiar with this platform, we can try it for free to get acquainted with it.

Google Gmail indicates that Google is used for email management. Therefore, it can also suggest that we could access open GDrive folders or files with a link.

LogMeIn is a central place that regulates and manages remote access on many different levels. However, the centralization of such operations is a double-edged sword. If access as an administrator to this platform is obtained (e.g., through password reuse), one also has complete access to all systems and information.

Mailgun offers several email APIs, SMTP relays, and webhooks with which emails can be managed. This tells us to keep our eyes open for API interfaces that we can then test for various vulnerabilities such as IDOR, SSRF, POST, PUT requests, and many other attacks.

Outlook is another indicator for document management. Companies often use Office 365 with OneDrive and cloud resources such as Azure blob and file storage. Azure file storage can be very interesting because it works with the SMB protocol.

The last thing we see is INWX. This company seems to be a hosting provider where domains can be purchased and registered. The TXT record with the "MS" value is often used to confirm the domain. In most cases, it is similar to the username or ID used to log in to the management platform.
\\\\\\\=================================
Cloud Resources
the use of cloud, AWS, GCP, Azure, and others is now one of the essential components for many companies nowadays. after all all company want to be able to do their work from anywhere, so they need a central point for all management,
the config made by the admin may nevertheless make the company cloud resources vul. this often starts with the s3 bucket (AWS), blobs(Azure), cloud storage(GCP) which can be accessed without authentication if configured incorrectly
\\company hosted servers
$for i in $(cat subdomainlist);do host $i | grep "has address" | grep inlanefreight.com | cut -d" " -f1,4;done
often cloud storage is added to the DNS list when used for administrative purposes by other employees. Ex on our contract during the IP lookup, we have already seen that one IP addr belongs to the S3-website-... server
-there are diff ways to finds such cloud storage. one of the easiest and most used is google search combined with Google Dorks. 
EX: $Google Dorks inurl: and intext: to narrow our search 
\\Google Search for AWS
$intext:honda inurl:amazoneaws.com
\\Google Search for Azure
$intext:honda inurl:blob.core.windows.net
-> it may result in files such as text documents, presentations, codes, and many others.
such content is also often included in the source code of the web pages. from where the images, JavaScript codes, or CSS are loaded.this procedure often relieves the web server and does not store unnecessary content
\\Target website -source code
3rd party providers such as also tell us alot about company infra.as positive side effect we can also see that Cloudflare;s security assessment status has been clasified as "Safe". this means we have already found a security measure that can be noted for the second layer (gateway)
https://domain.glass/
https://buckets.grayhatwarfare.com/
do different searches, discover aws, azure, and GCP cloud storage, 
NOTE: companies also use abbreviations of the company name,which are then used accordingly within the IT infra
\\Private and Public SSH keys leaked
\\=========================================
Staff
searching for and identifying employees on social media platforms can also reveal alo about team infra and makeup
-> can lead to us identifying which technologies, programming languages, and even soft app are being used.
EX linkedin or xing
if we do little search for Django security misconfig, we can come across the: https://github.com/boomcamp/django-security
we can use this to understand the inner structure of Django and how it work
-> take investigation we found JWT token
\\============================================
FTP one of the oldest protocols on the internet. the FTP runs within the app layer of the TCP/IP protocol stack.
same layer as HTTP or POP these proto also work with the support of browsers or email clients to perform their services. there are also special FTP programs for the File Transfer protocol
TCP port 21
-usually, we need credential to use FTP on a server, FTP is a clear-text protocol that can sometimes be sniffed if condition on the network are right.
-there is also the possibility that a server offers anonymous FTP the server operator then allows any user to upload or download files via FTp without using a password
-> there are security risk associated with such apublic FTP server. the options for users are usually limited
\\TFTP
Trivial File Transfer protocol is simplier than FTP and performs file transfer betw client and server processes.
-it doesnot provide user authen and other value feature supported by FTP, in addition, while FTP uses TCP, TFTP uses UDP, making it an unrealiable protocol and causing it to use UDP-assisted app layer recovery
-FTP use TCP, TFTP uses UDP
TFP unlike FTP may only be used in local and protected networks.
-few command of TFTP
commands            Description
connect             Sets the remote host, and optionally the port for file transfer
get	Transfers a file or set of files from the remote host to the local host.
put	Transfers a file or set of files from the local host onto the remote host.
quit	Exits tftp.
status	Shows the current status of tftp, including the current transfer mode (ascii or binary), connection status, time-out value, and so on.
verbose	Turns verbose mode, which displays additional information during file transfer, on or off.
-unlike the FTP clinet, TFTP does not have directory listing functionality
\\
Default Configuration
one of the most used FTP servers on Linux-based distributions is vsFTPd. the default config of vsFTPd can be found in
/etc/vsftpd.conf, and some settings are already predefined by default. it is highly recommended to install the vsFTPd server on a VM and have a closer look at this configuration
\\
Install vsFTPd
$sudo apt install vsftpd
there are many diff alternatives to it, which also bring among other things
$the config file does not contain all possible setings that can be made the existing and missing ones can be found on the: http://vsftpd.beasts.org/vsftpd_conf.html
\\vsFTPd Config File
$cat /etc/vsftpd.conf | grep -v "#"
There is a file called /etc/ftpusers that we also need to pay attention to, as this file is used to deny certain users access to the FTP service. in the following example, the users guest, john and kevin are not permitted to login to the FTP service, even if they exist on the Linux system
\\ftpusers
$cat /etc/ftpusers
\\
Dangerous setting
Setting	Description
anonymous_enable=YES	Allowing anonymous login?
anon_upload_enable=YES	Allowing anonymous to upload files?
anon_mkdir_write_enable=YES	Allowing anonymous to create new directories?
no_anon_password=YES	Do not ask anonymous for password?
anon_root=/home/username/ftp	Directory for anonymous.
write_enable=YES	Allow the usage of FTP commands: STOR, DELE, RNFR, RNTO, MKD, RMD, APPE, and SITE?
$http://vsftpd.beasts.org/vsftpd_conf.html
this often allow everyone on the internal network to share files and data without anonymous login
asa connect to the vsFTPdserver the response code 220 -> banner show  service and even version of it
\\Anonymous login
$ftp 10.129.14.136 -> ls
\\vsFTPd status
$status $debug $trace 
\\vsFTPd Detailed output
$debug  or $trace  -> ls
Setting	Description
dirmessage_enable=YES	Show a message when they first enter a new directory?
chown_uploads=YES	Change ownership of anonymously uploaded files?
chown_username=username	User who is given ownership of anonymously uploaded files.
local_enable=YES	Enable local users to login?
chroot_local_user=YES	Place local users into their home directory?
chroot_list_enable=YES	Use a list of local users that will be placed in their home directory?

Setting	Description
hide_ids=YES	All user and group information in directory listings will be displayed as "ftp".
ls_recurse_enable=YES	Allows the use of recurse listings.


