\\Introduction to Pivoting, Tunneling, and Port Forwarding
There are many different terms used to describe a compromised host that we can use to pivot to a previously unreachable network segment. Some of the most common are:

Pivot Host
Proxy
Foothold
Beach Head system
Jump Host
\\Lateral Movement, Pivoting, and Tunneling Compared
-Pivoting’s main purpose is to bypass network segmentation and reach isolated networks. Tunneling is one technique used during pivoting — it hides one type of traffic inside another to secretly pass it through a path. For example, hiding a key inside a stuffed toy so only the recipient knows it’s there. VPNs and secure browsers work the same way by tunneling traffic.

In cybersecurity, many terms overlap. Pivoting is often confused with lateral movement, but they are not identical. Lateral movement means using access on one host to compromise other hosts. Pivoting is specifically about using a compromised system as a bridge into another network segment. Tunneling is one method to make pivoting possible.

\\Lateral
Lateral Movement — very short version:
Lateral movement is using access on one system to reach other hosts, apps, or services inside a network, often to find credentials or resources needed for privilege escalation and deeper compromise. Trusted definitions include Palo Alto Networks and MITRE.
Example (short): after initial access and control of a local admin account, a network scan finds three Windows machines; reusing the same admin creds works on one, letting you move to that host and continue compromising the domain.

\\Pivot
Using one or more compromised hosts to cross network boundaries you normally can't reach, letting attackers move deeper by targeting specific systems or infrastructure (e.g., dual-homed machines).

Example (1 sentence): on a segmented network we compromised an engineering workstation with two NICs (enterprise + operational), used it as a bridge, and reached the otherwise isolated operational network.

\\Tunneling
We hide and move traffic using common protocols (HTTP/HTTPS, SSH, TLS) to obfuscate C2 and exfiltration, embedding commands in normal-looking requests so defenders miss them. Tunneling masks traffic; lateral movement spreads across a network and elevates access; pivoting uses compromised hosts to reach otherwise inaccessible segments. Keep those distinctions in mind as we move into the networking concepts that enable these tactics.

\\=================================
The Networking Behind Pivoting
IP Addressing & NICs
Every computer that is communicating on a network needs an IP address. If it doesn't have one, it is not on a network. The IP address is assigned in software and usually obtained automatically from a DHCP server. It is also common to see computers with statically assigned IP addresses. Static IP assignment is common with:
Servers
Routers
Switch virtual interfaces
Printers
And any devices that are providing critical services to the network
\\Using Ifconfig
Ipconfig
Nat using to translate IF private IP to Public 
-https://web.archive.org/web/20220817112619/https://www.cisco.com/c/dam/en_us/solutions/industries/docs/gov/IPV6at_a_glance_c45-625859.pdf
IPV4 can IPV6 can run in a dual-stack configuration 
-Each IPv4 address has a subnet mask that defines its network and host portions—like an area code for a phone number. If traffic is meant for another network, it’s sent to the default gateway, usually the router’s IP on the LAN. During pivoting, note what networks a compromised host can reach; documenting IP details is essential for effective movement.

\\Rounting
Any computer can act as a router — routing is defined by a routing table used to forward traffic by destination. In this module we’ll pivot hosts to route traffic (e.g., AutoRoute lets your attack box add routes via a pivot). Check routing on Pwnbox with netstat -r or ip route.
\\Rounting Table on Pawnbox
$netstat -r 

-All OSes use a routing table to decide where to send packets — e.g., the table shows which gateway and interface (Iface) to use to reach 10.129.10.25. Pwnbox learns routes from its directly connected interfaces (eth0, eth1, tun0), while routers may use static routes, dynamic protocols, and connected interfaces. Traffic to unknown networks goes to the default route (gateway of last resort). Check a host’s routing table when pivoting to see reachable networks or routes you might add.

\\Protocols, Services & Ports
Protocols are rules for network communication; services are identified by logical (software) ports. An IP names a host and an open port names an application — attackers can use firewall-allowed ports/protocols to gain a foothold.

\\\\\\\\\\\\\\\\\\\================================================
Dynamic Port Forwarding with SSH and SOCKS tunneling
\\Port Forwarding in Context
Port forwarding redirects traffic from one port to another (usually over TCP); protocols like SSH or SOCKS can encapsulate the forwarded traffic, letting you pivot through a compromised host and bypass firewalls.

\\SSH Local Port Forwarding

\\Scanning the Pivot target 
$nmap -sT -p22,3306 10.129.202.64
-Nmap shows SSH open. MySQL is on the server at localhost:3306 — either SSH in or SSH-forward remote 3306 to local 1234 so you can access/test it locally.
Example: ssh -L 1234:localhost:3306 user@target

\\Executing the Local Port Forward
$ssh -L 1234:localhost:3306 ubuntu@10.129.202.64
-The -L command tells the SSH client to request the SSH server to forward all the data we send via the port 1234 to localhost:3306 on the Ubuntu server. By doing this, we should be able to access the MySQL service locally on port 1234. We can use Netstat or Nmap to query our local host on 1234 port to verify whether the MySQL service was forwarded.

\\Confirming Port Forward with Netstat
$netstat -antp | grep 1234

\\Confirming Port Forward with Nmap
$nmap -V -sV -p1234 localhost

-Similarly, if we want to forward multiple ports from the Ubuntu server to your localhost, you can do so by including the local port:server:port argument to your ssh command. For example, the below command forwards the apache web server's port 80 to your attack host's local port on 8080.

\\Forwarding Multiple Ports
$ssh -L 1234:localhost:3306 -L 8080:localhost:80 ubuntu@10.129.202.64

\\Setting up to Pivot

Now, if you type ifconfig on the Ubuntu host, you will find that this server has multiple NICs:

One connected to our attack host (ens192)
One communicating to other hosts within a different network (ens224)
The loopback interface (lo).

\\Looking for Opportunities to Pivot using ifconfig
ifconfig
ChatGPT said:

We don’t know which services run on 172.16.5.0/23, so we must scan that subnet (or 172.16.5.1–200). Our attack host has no route to it, so we pivot through the Ubuntu server using SSH dynamic port forwarding (a local SOCKS listener) to route traffic into the target network. SOCKS (Socket Secure) proxies forward client-generated traffic through the server to bypass firewalls; SOCKS4 lacks auth/UDP, SOCKS5 supports both.

\\Enabling Dynamic Port Forwarding with SSH
$ssh -D 9050 ubuntu@10.129.202.64 
-D arg requests the SSH svr to enable dynamic port forwarding.
-Use ssh -D to start a local SOCKS listener (commonly on port 9050), then run proxychains to force an application's TCP traffic through that SOCKS/TOR/HTTP proxy (and chain proxies if needed). This routes traffic via the pivot host—so the target sees the pivot's IP, not yours.
-To inform proxychains that we must use port 9050, we must modify the proxychains configuration file located at /etc/proxychains.conf. We can add socks4 127.0.0.1 9050 to the last line if it is not already there.

\\Checking /etc/proxychains.conf
$tail -4 /etc/proxychains.conf
#meanwile
$defaults set to "tor"
sock4 127.0.0.1 9050
-Now when you start Nmap with proxychains using the below command, it will route all the packets of Nmap to the local port 9050, where our SSH client is listening, which will forward all the packets over SSH to the 172.16.5.0/23 network.

\\Using Nmap with proxychains
$proxychains nmap -v -sn 172.16.5.1-200
Packing Nmap through proxychains and a SOCKS proxy is SOCKS tunneling. Proxychains only supports full TCP connect scans (partial/stealth scans give wrong results). Note Windows Defender often blocks ICMP, so host-alive checks can fail. Full-range TCP scans are slow—scan individual hosts or small live ranges (here: 172.16.5.19). We'll run the remote scan with the command below.

\\Enum the Windows Target through Proxychains
$proxychains nmap -v -Pn -sT 172.16.5.19
-The Nmap scan shows several open ports, one of which is RDP port (3389). Similar to the Nmap scan, we can also pivot msfconsole via proxychains to perform vulnerable RDP scans using Metasploit auxiliary modules. We can start msfconsole with proxychains.

\\Using Metasploit with Proxychains
-We can also open Metasploit using proxychains and send all associated traffic through the proxy we have established.
$$proxychains msfconsole
-Let's use the rdp_scanner auxiliary module to check if the host on the internet network is listening on 3389
\\Using rdp_scanner module
msf6>search rdp_scanner
-at the bottom of the output above, we can see the RDP port open with the Windows OS version
-Depending on the level of access we have to this host during an assessment, we may try to run an exploit or log in using gathered credentials. For this module, we will log in to the Windows remote host over the SOCKS tunnel. This can be done using xfreerdp. The user in our case is victor, and the password is pass@123

\\Using xfreerdp with Proxychains
$proxychains xfreerdp /v:172.16.5.19 /u:vicctor /p:pass@123
-The xfreerdp command will require an RDP certificate to be accepted before successfully establishing the session. After accepting it, we should have an RDP session, pivoting via the Ubuntu server.

<test> You have successfully captured credentials to an external facing Web Server. Connect to the target and list the network interfaces. How many network interfaces does the target web server have? (Including the loopback interface)
$ssh -D 9050 ubuntu@10.129
$tail -4 /etc/proxychains.conf
#meanwile
#defaults set to "tor"
socks4: 127.0.0.1 9050

Subsequently, students need to connect through the target pivot host to the DC on the internal network from Pwnbox/PMVPN, utilizing the credentials victor:pass@123:
proxychains xfreerdp /v:172.16.5.19 /u:victor /p:pass@123

